<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chúc mừng sinh nhật</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: #fff5f8;
    }
    .letter {
      position: relative;
      overflow: hidden;
    }
    .letter__bg {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: 1;
      border: none;
      pointer-events: none;
    }
    .content__letter, .title__letter, .close {
      position: relative;
      z-index: 2;
    }
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }
    .box__letter, .letter__border {
      display: none;
    }
    .overlay-bg {
      background-color: rgba(255,255,255,0.9);
      padding: 20px;
      border-radius: 10px;
      max-width: 800px;
      margin: 0 auto;
      color: #d00;
      font-weight: bold;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
    }
    .box__account {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }
    .box__account .image img {
      width: 150px;
      border-radius: 50%;
    }
    .box__account .name {
      margin-top: 10px;
      font-size: 18px;
      font-weight: bold;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
    }
    .text__letter p {
      white-space: normal;
      line-height: 1.6;
      font-size: 18px;
    }
    #intro-screen {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #ffe0eb;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    #intro-screen h2 {
      color: #d6336c;
      margin-bottom: 20px;
    }
    #intro-screen button {
      padding: 15px 30px;
      font-size: 18px;
      background-color: #d6336c;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<!-- MÀN HÌNH CHỜ -->
<div id="intro-screen">
  <h2>🎉 Bấm vào đây đi 🎶</h2>
  <button id="startBtn">Bắt đầu</button>
</div>

<!-- NHẠC -->
<audio id="birthdayMusic" loop>
  <source src="./audio/cmsn.mp3" type="audio/mpeg">
</audio>

<!-- PHẦN 1 -->
<div id="section1" class="section">
  <!-- ... giữ nguyên phần hiển thị Happy Birthday như bạn đã viết ... -->
</div>

<!-- PHẦN 2 -->
<div id="section2" class="section">
  <!-- ... giữ nguyên phần hiển thị thư như bạn đã viết ... -->
</div>

<script>
  const music = document.getElementById("birthdayMusic");
  const introScreen = document.getElementById("intro-screen");
  const startBtn = document.getElementById("startBtn");

  startBtn.addEventListener("click", () => {
    introScreen.style.display = "none";
    music.play().catch(e => {
      alert("Trình duyệt không cho phát nhạc tự động, hãy thử lại!");
    });
    document.getElementById("section1").classList.add("active");
    initBirthday();
  });

  function initBirthday() {
    const datetxt = "25-06-2009";
    const datatxtletter = `✨ Chúc mừng sinh nhật nha! Chúc bạn tuổi mới thật vui vẻ, luôn cười tươi, học tốt và gặp nhiều điều may mắn. Hy vọng bạn sẽ luôn giữ được sự dễ thương và đáng yêu như bây giờ. Chúc sinh nhật thật hạnh phúc và nhận được thật nhiều quà nha! 🎂🎁💖`;
    const titleLetter = "Gửi Nguyên";

    const dateSpan = document.querySelector(".date__of__birth span");
    let index = 0;
    let finished = false;
    let transitionTimeout;

    function startTransition() {
      document.getElementById("section1").classList.remove("active");
      document.getElementById("section2").classList.add("active");
      showLetter();
    }

    setTimeout(() => {
      const interval = setInterval(() => {
        if (index < datetxt.length) {
          dateSpan.textContent += datetxt[index];
          index++;
        } else {
          clearInterval(interval);
          document.querySelector(".date__of__birth").prepend(document.createElement("i")).className = "fa-solid fa-star";
          document.querySelector(".date__of__birth").appendChild(document.createElement("i")).className = "fa-solid fa-star";
          finished = true;
          transitionTimeout = setTimeout(startTransition, 5000);
        }
      }, 100);
    }, 1000);

    document.getElementById("btn__letter").addEventListener("click", () => {
      if (!finished) clearTimeout(transitionTimeout);
      startTransition();
    });

    function showLetter() {
      const charArrTitle = titleLetter.split('');
      const charArrContent = datatxtletter.split('');
      let currentIndexTitle = 0;
      let currentIndexLetter = 0;

      $(".box__letter").slideDown();
      setTimeout(() => $(".letter__border").slideDown(), 1000);

      setTimeout(() => {
        const intervalTitle = setInterval(() => {
          if (currentIndexTitle < charArrTitle.length) {
            const el = document.querySelector(".title__letter");
            el.textContent += charArrTitle[currentIndexTitle];
            const i = document.createElement("i");
            i.className = "fa-solid fa-heart";
            el.appendChild(i);
            currentIndexTitle++;
          } else {
            clearInterval(intervalTitle);
          }
        }, 100);
      }, 2000);

      setTimeout(() => {
        document.querySelector("#heart__letter").classList.add("animationOp");
        document.querySelector(".love__img").classList.add("animationOp");
        document.querySelector("#mewmew").classList.add("animationOp");
      }, 2800);

      setTimeout(() => {
        document.querySelectorAll(".heart").forEach(item => item.classList.add("animation"));
      }, 3500);

      setTimeout(() => {
        const p = document.querySelector(".text__letter p");
        const intervalContent = setInterval(() => {
          if (currentIndexLetter < charArrContent.length) {
            p.textContent += charArrContent[currentIndexLetter];
            currentIndexLetter++;
          } else {
            clearInterval(intervalContent);
          }
        }, 50);
      }, 6000);
    }
  }
</script>
</body>
</html>
